  <!DOCTYPE html>
<html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Jadwal Open Trip Canyoneering Pacet</title>

<style>
  :root{
    --bg-dark:#111;
    --card:#f2f2f2;
    --brand:#ff5500; /* oranye brand */
    --wa-green:#25D366;
    --wa-dark:#128C7E;
    --poster-width:1080px;
    --poster-height:1920px;
  }

  html,body{height:100%; margin:0; font-family:Arial, Helvetica, sans-serif; background:var(--bg-dark); color:#fff;}
  .wrap{max-width:1000px; margin:0 auto; padding:18px; box-sizing:border-box;}

  /* MAIN SECTION */
  .section { background:var(--card); padding:20px; color:#111; border-radius:8px; box-shadow:0 6px 18px rgba(0,0,0,0.25); }
  h1.page-title{margin:0 0 12px 0; font-size:20px; text-align:center; color:#111;}
  .controls { display:flex; gap:12px; justify-content:center; align-items:center; margin-bottom:12px; flex-wrap:wrap; }
  select#monthSelect{ padding:10px 12px; font-size:15px; border-radius:8px; border:2px solid var(--brand); min-width:200px; background:white; }
  #loading { text-align:center; font-weight:600; color:var(--brand); margin-top:8px; }

  .table-container{ overflow-x:auto; margin-top:12px; }
  table{ width:100%; border-collapse:collapse; min-width:360px; background:#fff; color:#111; border-radius:6px; overflow:hidden; }
  thead th{ background:var(--brand); color:#fff; padding:10px; text-align:center; font-size:14px; }
  td, th{ border:1px solid #e6e6e6; padding:10px; font-size:14px; text-align:center; vertical-align:middle; }
  .slot-tersisa{ display:inline-block; min-width:46px; padding:6px 10px; border-radius:6px; font-weight:700; color:#fff; }
  .tersedia{ background:#28a745; }
  .penuh{ background:#dc3545; }

  .btn-daftar{ background: linear-gradient(180deg,var(--wa-green),var(--wa-dark)); color:#fff; border:none; padding:8px 12px; border-radius:8px; cursor:pointer; font-weight:700; display:inline-flex; gap:8px; align-items:center; justify-content:center; box-shadow:0 6px 18px rgba(0,0,0,0.18); text-decoration:none; }
  .btn-daftar:active{ transform:translateY(1px); }

  .modal-backdrop{ position:fixed; inset:0; display:none; align-items:center; justify-content:center; z-index:9999; }
  .modal-backdrop.show{ display:flex; background:rgba(0,0,0,0.55); }
  .modal{ width:94%; max-width:420px; background:#fff; color:#111; border-radius:10px; padding:14px; box-shadow:0 12px 40px rgba(0,0,0,0.4); }
  .modal h3{ margin:0 0 8px 0; font-size:18px; }
  .modal label{ display:block; font-size:13px; margin-top:8px; color:#333; }
  .modal input[type="text"], .modal input[type="number"], .modal textarea{ width:100%; padding:10px; font-size:14px; border-radius:8px; border:1px solid #ddd; box-sizing:border-box; margin-top:6px; }
  .modal .row{ display:flex; gap:8px; margin-top:12px; }
  .modal .row .col{ flex:1; }
  .modal .actions{ display:flex; gap:10px; margin-top:14px; justify-content:flex-end; }
  .btn-cancel{ background:#fff; color:#333; border:1px solid #ccc; padding:8px 12px; border-radius:8px; cursor:pointer; }
  .btn-send{ background: linear-gradient(180deg,var(--wa-green),var(--wa-dark)); color:#fff; border:none; padding:8px 12px; border-radius:8px; cursor:pointer; font-weight:700; }

  /* ---------------------------
     POSTER LAYOUT (untuk export)
     --------------------------- */
  #exportPoster { display:none; } /* kept hidden in normal UI */

  /* fixed poster container */
  .poster {
  width:1080px;
  height:1920px;
  margin:0 auto;
  box-sizing:border-box;
  padding:80px 90px;
  position: relative;
  font-family: "Poppins", Arial, sans-serif;
  color:#fff;
  overflow:hidden;

  /* Background foto + overlay gelap */
  background:
      linear-gradient(180deg, rgba(0,0,0,0.75), rgba(0,0,0,0.75)),
      url('canyoning.jpg') center/cover no-repeat;
}

  }
  .poster .logo { width:220px; margin:0 auto 24px auto; text-align:center; font-weight:700; color:var(--brand); font-size:20px; letter-spacing:1px;}
  .poster h2 {
  font-size: 84px;     /* sebelumnya sekitar 58‚Äì64px */
  font-weight: 800;
  letter-spacing: 2px;
  margin-bottom: 10px;
  text-transform: uppercase;
}

  .poster h3 {
  font-size: 48px;     /* naikkan untuk proporsional */
  font-weight: 600;
  margin-top: -10px;
  letter-spacing: 1px;
}
/* TURUNKAN AREA JADWAL SEDIKIT */
.poster .grid {
  margin-top: 20px !important; /* bebas: 60‚Äì200px */
}



   .poster .grid {
  display: grid;
  grid-template-columns: 1fr 12px 1fr; /* tetap 2 kolom + divider */
  gap: 24px;
  align-items: start;
  margin-top: 12px;
  height: auto; /* jangan pakai height paksa */
}

/* Tanggal dalam setiap kolom vertikal dulu */
.col-left,
.col-right {
  column-count: 1;    /* default 1 kolom */
  display: block;
}

/* Jika mau isi panjang, ubah jadi multi kolom per sisi */
.col-left,
.col-right {
  column-count: 1;        /* ubah ke angka sesuai kebutuhan */
  column-gap: 12px;
}

.date-item {
  break-inside: avoid;
  margin-bottom: 6px;
  display: block;
}

  .poster .col-left, .poster .col-right{
    padding: 12px 6px;
    overflow:hidden;
  }
  .poster .divider {
    background: rgba(255,255,255,0.12);
    width:12px;
    justify-self:center;
    height:100%;
    border-radius:6px;
  }
  .item-row {
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:12px;
    padding: 10px 8px;
  }
  .item-date {
    border:2px solid rgba(255,255,255,0.18);
    padding:10px 14px;
    border-radius:12px;
    min-width:180px;
    text-align:center;
    font-weight:700;
    font-size:18px;
    color:#fff;
    background:rgba(0,0,0,0.25);
  }
  .item-slot {
    min-width:220px;
    text-align:center;
  }
  .pill {
    display:inline-block;
    padding:12px 22px;
    border-radius:22px;
    font-weight:800;
    font-size:18px;
    background:var(--brand); /* oranye brand untuk semua pill */
    color:#fff;
    box-shadow: 0 6px 18px rgba(0,0,0,0.35);
  }
  .pill.full { 
    background: var(--brand);
    color:#fff;
    border:none;
  }

  .pill.libur {
    background: var(--brand);
    color:#fff;
  }


  .poster .footer {
  width: 100%;
  text-align: center;
  padding-bottom: 40px;
  margin-top: 15px;
  display: flex;
  flex-direction: column;
  gap: 12px;
  align-items: center;
  font-size: 22px;
  line-height: 1.3;
  color: #fff;
}

.poster .footer .brand-footer {
  font-size: 24px;
  font-weight: 700;
  letter-spacing: 0.5px;
}

.poster .footer-sosmed {
  display: flex;
  gap: 26px;
  font-size: 20px;
}

.poster .footer-sosmed .sosmed-item {
  display: flex;
  align-items: center;
  gap: 6px;
  font-weight: 600;
}

.poster .footer-sosmed .icon-svg {
  width: 22px;
  height: 22px;
  fill: white;     /* ikon putih untuk poster gelap */
}



  @media (max-width:480px){
    .wrap{ padding:14px; }
    h1.page-title{ font-size:18px; }
    td, th{ padding:8px; font-size:13px; }
  }

  /* Pastikan area export tidak keluar layar */
  .export-area {
    width:1080px;        /* ukuran poster */
    max-width:1080px;
    margin:0 auto;       /* wajib agar tidak geser kanan */
    overflow:hidden;     /* cegah potongan kanan */
    position:relative;
    transform:none !important; /* pastikan tidak ter-scale */
  }

  #exportPoster .ketentuan-box {
    margin-top: 25px;
    padding: 18px 20px;
    background: rgba(0,0,0,0.55);
    border-radius: 14px;
    color: #fff;
    font-size: 18px;
    line-height: 1.35;
}

#exportPoster .ketentuan-box h3 {
    font-size: 22px;
    text-align: center;
    margin-bottom: 10px;
    font-weight: 800;
}

#exportPoster .ketentuan-box .list {
    padding-left: 18px;
    margin-bottom: 12px;
}

#exportPoster .ketentuan-box .list li {
    margin-bottom: 4px;
}

#exportPoster .ketentuan-box h4 {
    font-size: 20px;
    margin-bottom: 4px;
    font-weight: 700;
}

#exportPoster .ketentuan-box .pembayaran p {
    margin-bottom: 10px;
}

#exportPoster .ketentuan-box .info {
    font-size: 17px;
    margin-bottom: 8px;
    opacity: 0.9;
}

#exportPoster .ketentuan-box .closing {
    font-size: 18px;
    text-align: center;
    font-weight: 600;
    line-height: 1.35;
}


  /* Matikan transform/zoom saat export */
  .exporting .export-area, .exporting .export-area * {
    transform:none !important;
    zoom:unset !important;
  }

  /* small helpers */
  .hide-on-export { }
  .exporting .hide-on-export { display:none !important; }

  .poster-logo {
  width: 320px; /* ukuran pas dengan proporsi logo Anda */
  margin: 0px auto 25px;
  display: block;
  image-rendering: -webkit-optimize-contrast;
}
.poster-title {
  text-align: center;
}
.poster-logo {
  width:200px;        /* ukuran sudah kecil */
  margin:10px auto 10px; /* jarak atas & bawah lebih dekat */
}

.poster-title h2 {
  margin:5px 0 0;     /* OPEN TRIP lebih dekat ke logo */
}

.poster-title h3 {
  margin:30;           /* CANYONEERING SCHEDULE menempel ke H2 */
  font-size:58px;     /* tetap besar */
  line-height:1.1;    /* lebih rapat */
}
.poster-title h4 {
  margin-top:80px;
  margin-bottom: 5px;           /* CANYONEERING SCHEDULE menempel ke H2 */
  font-size:38px;     /* tetap besar */
  line-height:1.1;    /* lebih rapat */
}



</style>
<!-- Import Montserrat -->
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">

<style>
#exportPoster * {
    font-family: 'Montserrat', sans-serif !important;
}
</style>

</head>
<body>
  
  <div class="wrap">
    <div class="section" role="main" aria-labelledby="pageTitle">

      <h1 id="pageTitle" class="page-title">Jadwal Open Trip TOS Canyoneering</h1>

      <!-- Kontrol -->
      <div class="controls">
    

        <select id="monthSelect" aria-label="Pilih Bulan"></select>
      </div>

      <!-- Loading -->
      <div id="loading">Mengambil data...</div>

      <!-- Wrapper tabel -->
      <div id="jadwal-wrapper" class="table-container" style="margin-top:16px;">

        <!-- TABEL UTAMA (HANYA ADA 1!) -->
        <table id="tripTable" style="display:none;">
          <thead>
            <tr>
              <th style="width:45%">Tanggal</th>
              <th style="width:25%">Slot Tersisa</th>
              <th class="hide-on-export" style="width:30%">Aksi</th>
            </tr>
          </thead>
          <tbody id="tableBody"></tbody>
        </table>

      </div> <!-- END WRAPPER -->
          <button id="btnExport" style="padding:10px 14px;border-radius:8px;border:none;background:var(--brand);color:#fff;font-weight:700;cursor:pointer;box-shadow:0 6px 18px rgba(0,0,0,0.18);">
          Export Poster (PNG)
        </button>
    </div>
  </div>

  <!-- Modal Pendaftaran -->
  <div id="modalBackdrop" class="modal-backdrop" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="modal" role="document">
      <h3 id="modalTitle">Daftar Open Trip</h3>
      <div id="selectedDateText" style="color:#444;font-size:14px;margin-bottom:6px;"></div>

      <label for="inputName">Nama Lengkap</label>
      <input id="inputName" type="text" placeholder="Masukkan nama lengkap" autocomplete="name" required />

      <div class="row">
        <div class="col">
          <label for="inputQty">Jumlah Peserta</label>
          <input id="inputQty" type="number" min="1" value="1" />
        </div>
        <div class="col">
          <label for="inputPhone">No. HP (opsional)</label>
          <input id="inputPhone" type="text" placeholder="08xxxx (opsional)" />
        </div>
      </div>

      <label for="inputNote">Catatan (opsional)</label>
      <textarea id="inputNote" rows="3" placeholder="Contoh: Sewa sepatu ukuran 42"></textarea>

      <div class="actions">
        <button class="btn-cancel" id="btnCancel">Batal</button>
        <button class="btn-send" id="btnSend">Kirim via WhatsApp</button>
      </div>
    </div>
  </div>

  <!-- AREA YANG AKAN DIRENDER UNTUK POSTER (HIDDEN) -->
  <div id="exportPoster" aria-hidden="true"></div>

<script>
/* CONFIG */
const apiURL = "https://script.google.com/macros/s/AKfycbwoQKn-H3UjntAj1onCpgsOFN1PPM3b71xAB1iS9ROfDmwKyL9gVg89MX8S8uTj_N3x/exec";
const saveURL = "https://script.google.com/macros/s/AKfycbywQBG9xMDjRshEg07HFuGDuHwyTIKHRJEmXSbxEqj8OU1PJIYnWUi63v72h14TaxzL/exec";
const MAX_SLOT = 17;
const WA_NUMBER = "62895400520827"; // internasional format

/* STATE */
let sheetsData = [];
let currentSelectedDateISO = null;

/* ELEMENTS */
const monthSelect = document.getElementById("monthSelect");
const loadingEl = document.getElementById("loading");
const tripTable = document.getElementById("tripTable");
const tableBody = document.getElementById("tableBody");
const modalBackdrop = document.getElementById("modalBackdrop");
const selectedDateText = document.getElementById("selectedDateText");
const inputName = document.getElementById("inputName");
const inputQty = document.getElementById("inputQty");
const inputPhone = document.getElementById("inputPhone");
const inputNote = document.getElementById("inputNote");
const btnCancel = document.getElementById("btnCancel");
const btnSend = document.getElementById("btnSend");
const btnExport = document.getElementById("btnExport");
const exportPosterWrapper = document.getElementById("exportPoster");

/* LOAD DATA (dengan cache sederhana) */
const CACHE_KEY = "tripDataCache";
const CACHE_TIME = 30 * 60 * 1000; // 30 menit

async function loadData() {
  try {
    const cached = localStorage.getItem(CACHE_KEY);
    if (cached) {
      const parsed = JSON.parse(cached);
      const now = Date.now();
      if (now - parsed.timestamp < CACHE_TIME) {
        sheetsData = parsed.data;
        populateMonthsAndDisplay();
        console.log("‚úî Menggunakan cache");
        return;
      }
    }

    console.log("‚Üª Mengambil data dari API...");
    const res = await fetch(apiURL, { cache: "no-store" });
    const json = await res.json();
    sheetsData = json;

    localStorage.setItem(CACHE_KEY, JSON.stringify({ timestamp: Date.now(), data: json }));
    populateMonthsAndDisplay();
  } catch (err) {
    loadingEl.innerText = "Gagal mengambil data!";
    console.error(err);
  }
}

function populateMonthsAndDisplay() {
  monthSelect.innerHTML = "";
  sheetsData.forEach(sheet => {
    const opt = document.createElement("option");
    opt.value = sheet.sheetName;
    opt.textContent = sheet.sheetName;
    monthSelect.appendChild(opt);
  });

  if (monthSelect.options.length > 0) {
    displayMonth(monthSelect.value);
  }

  loadingEl.style.display = "none";
  tripTable.style.display = "table";
  monthSelect.addEventListener("change", e => displayMonth(e.target.value));
}

/* DISPLAY MONTH (tabel) */
function displayMonth(sheetName){
  tableBody.innerHTML = "";
  const sheet = sheetsData.find(s => s.sheetName === sheetName);
  if(!sheet) return;

  const today = new Date();
  today.setHours(0,0,0,0);

  sheet.data.forEach(row => {
    if(row.length === 2 && row[0] && typeof row[1] === "number"){
      const tanggalISO = row[0];
      const dateObj = new Date(tanggalISO);

      // Skip data yang sudah lewat
      if(dateObj < today) return;

      const jumlahFix = row[1];
      const slotTersisa = Math.max(0, MAX_SLOT - jumlahFix);
      const tanggalText = dateObj.toLocaleDateString("id-ID", {
        weekday:"long", year:"numeric", month:"long", day:"numeric"
      }).replace(/^\w/, c => c.toUpperCase());

      const tr = document.createElement("tr");
      const tdDate = document.createElement("td");
      tdDate.textContent = tanggalText;

      const tdSlot = document.createElement("td");
      const span = document.createElement("span");

      // Jika hari Jumat -> lock (libur)
      const isFriday = dateObj.getDay() === 5; // 5 = Friday
      // Skip hari Jumat ‚Üí tidak ditampilkan di tabel sama sekali
      if(dateObj.getDay() === 5){
          return;
      }
       else {
        span.className = "slot-tersisa " + (slotTersisa>0 ? "tersedia" : "penuh");
        span.textContent = slotTersisa === 0 ? "FULL" : slotTersisa;
      }
      tdSlot.appendChild(span);

      const tdAction = document.createElement("td");
      tdAction.classList.add("hide-on-export");
      if(isFriday){
        tdAction.textContent = "-";
        tdAction.title = "Operasional libur setiap hari Jumat ‚Äî pendaftaran ditutup.";
        tdAction.setAttribute("aria-label", "Libur hari Jumat ‚Äî pendaftaran ditutup");
      } else {
        if(slotTersisa > 0){
          const btn = document.createElement("button");
          btn.className = "btn-daftar";
          btn.type = "button";
          btn.innerHTML = `<svg viewBox="0 0 24 24" width="16" height="16" aria-hidden="true" focusable="false" style="display:block;">
              <path fill="#fff" d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.1-.472-.149-.67.15-.198.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.149-1.255-.462-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.298-.018-.459.130-.608.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.372-.025-.521-.075-.149-.669-1.612-.916-2.209-.242-.579-.487-.5-.67-.510l-.57-.010c-.198 0-.521.075-.793.372-.272.298-1.04 1.016-1.04 2.479s1.065 2.876 1.213 3.074c.149.199 2.095 3.2 5.076 4.487.709(.306) 1.26(.489) 1.69(.625) 0(.226 1.357 .194 1.87 .118 .57-.085 1.758-.718 2.007-1.413.248-.695 .248-1.29 .173-1.414-.074-.124-.272-.198-.57-.347z"/>
            </svg> <span style="line-height:1;">DAFTAR</span>`;
          btn.addEventListener("click", ()=> openRegistrationModal(tanggalISO, tanggalText));
          tdAction.appendChild(btn);
        } else {
          tdAction.textContent = "-";
        }
      }

      tr.appendChild(tdDate);
      tr.appendChild(tdSlot);
      tr.appendChild(tdAction);
      tableBody.appendChild(tr);
    }
  });

  if(tableBody.children.length === 0){
    const tr = document.createElement("tr");
    const td = document.createElement("td");
    td.colSpan = 3;
    td.style.padding = "18px";
    td.style.fontWeight = "600";
    td.textContent = "Tidak ada jadwal tersedia.";
    tr.appendChild(td);
    tableBody.appendChild(tr);
  }
}

/* MODAL */
function openRegistrationModal(tanggalISO, tanggalText){
  currentSelectedDateISO = tanggalISO;
  selectedDateText.textContent = `Tanggal: ${tanggalText}`;
  inputName.value = "";
  inputQty.value = 1;
  inputPhone.value = "";
  inputNote.value = "";
  modalBackdrop.classList.add("show");
  modalBackdrop.setAttribute("aria-hidden","false");
  setTimeout(()=> inputName.focus(), 120);
}
function closeModal(){
  modalBackdrop.classList.remove("show");
  modalBackdrop.setAttribute("aria-hidden","true");
}
function sendWhatsApp(){
  const name = inputName.value.trim();
  const qty = parseInt(inputQty.value, 10) || 1;
  const phone = inputPhone.value.trim();
  const note = inputNote.value.trim();

  if(!name){
    alert("Tolong masukkan nama lengkap.");
    inputName.focus();
    return;
  }

  const tripDate = new Date(currentSelectedDateISO);
  const tanggalText = tripDate.toLocaleDateString("id-ID", { year:"numeric", month:"long", day:"numeric" });
  const bulanText = tripDate.toLocaleDateString("id-ID", { month:"long", year:"numeric" });

  let message = `Halo TOS Adventure, saya ingin daftar Open Trip Canyoneering tanggal ${tanggalText}.\nNama: ${name}\nJumlah peserta: ${qty}`;
  if(phone) message += `\nNo HP: ${phone}`;
  if(note) message += `\nCatatan: ${note}`;
  message += `\n\nMohon konfirmasi ya. Terima kasih.`;

  const waUrl = `https://wa.me/${WA_NUMBER}?text=${encodeURIComponent(message)}`;

  // Buka WA dulu (synchronous, langsung dari event click)
  const newWin = window.open(waUrl, "_blank");

  const payload = {
    nama: name,
    nohp: phone,
    jumlah: qty,
    tanggal: tanggalText,
    bulan: bulanText,
    catatan: note
  };

  fetch(saveURL, {
    method: "POST",
    body: JSON.stringify(payload)
  }).catch(err => {
    console.warn("Gagal menyimpan ke spreadsheet:", err);
  });

  closeModal();
  if (!newWin) window.location.href = waUrl;
}

btnCancel.addEventListener("click", closeModal);
btnSend.addEventListener("click", sendWhatsApp);
modalBackdrop.addEventListener("click", (e)=>{
  if(e.target === modalBackdrop) closeModal();
});
document.addEventListener("keydown", (e)=>{
  if(e.key === "Escape" && modalBackdrop.classList.contains("show")) closeModal();
});


/* ---------------------------
   POSTER RENDER + EXPORT
   --------------------------- */

function buildPosterHTML(sheetName){
  const sheet = sheetsData.find(s => s.sheetName === sheetName);
  if(!sheet) return "<div></div>";

  const today = new Date(); today.setHours(0,0,0,0);
  const rows = sheet.data
    .filter(r => r.length===2 && r[0] && typeof r[1] === "number")
    .map(r => {
      const d = new Date(r[0]);
      return { dateObj: d, jumlahFix: r[1] };
    })
    .filter(item => item.dateObj >= today && item.dateObj.getDay() !== 5) // buang Jumat
    .sort((a,b) => a.dateObj - b.dateObj);

      // bagi data menjadi dua kolom vertikal
    const half = Math.ceil(rows.length / 2);
    const left  = rows.slice(0, half);      // urut penuh ke bawah dulu
    const right = rows.slice(half);         // sisanya lanjut di kolom kanan


  function rowToHTML(it){
    const dateObj = it.dateObj;
    const jumlahFix = it.jumlahFix;
    const slotTersisa = Math.max(0, MAX_SLOT - jumlahFix);
    const dateShort = dateObj.toLocaleDateString("id-ID", { day:"2-digit", month:"long" }).toUpperCase();
    const longText = dateObj.toLocaleDateString("id-ID", { weekday:"long", day:"numeric", month:"long" }).replace(/^\w/, c => c.toUpperCase());

    let pillText = "";
    if(slotTersisa === 0){
      pillText = "FULL SLOT";
    } else {
      pillText = `${slotTersisa} PAX`;
    }

    return `
      <div class="item-row" title="${longText}">
        <div class="item-date">${dateShort}</div>
        <div class="item-slot"><span class="pill">${pillText}</span></div>
      </div>
    `;
  }

  const poster = `
    <div class="poster" style="background-image:none;">
    <img src="logo-tos.png" alt="TOS Adventure" class="poster-logo" />

    <div class="poster-title">
      <h2>JADWAL</h2>
      <h3>TOS CANYONEERING</h3>
       <h4>SLOT TERSEDIA</h4>
    <br>
    </div>

      <div class="grid">
        <div class="col-left">
          ${left.map(rowToHTML).join("\n")}
        </div>

        <div class="divider"></div>

        <div class="col-right">
          ${right.map(rowToHTML).join("\n")}
        </div>
      </div>
      <div class="ketentuan-box">
  <h3>Syarat & Ketentuan</h3>

  <ul class="list">
    <li>Minimal keberangkatan <b>5 peserta</b>.</li>
    <li>Bisa join open trip jika kurang dari 5 orang.</li>
    <li>Konfirmasi peserta / reschedule maksimal <b>H-1</b>.</li>
    <li>Pembatalan hari-H ‚Üí <b>DP hangus</b>.</li>
  </ul>

  <h4>Pembayaran DP</h4>
  <p>
    BCA ‚Äì <b>6140846421</b><br>
    A.n. <b>Muhammad Fatichul Ichsan</b>
  </p>
</div>



    <div class="footer">
   <div class="brand-footer">TOS Rafting Pacet ‚Äì Canyoneering Pacet</div>

   <div class="footer-sosmed">
      <div class="sosmed-item"><span class="icon">üì∑</span> @tosraftingadventure</div>
      <div class="sosmed-item"><span class="icon">üéµ</span> @tosraftingpacet</div>
      <div class="sosmed-item"><span class="icon">üåê</span> wisataraftingpacet.com</div>
   </div>
</div>

  `;
  return poster;
}

/* EXPORT FUNCTION (menggunakan html2canvas) */
async function exportPoster(){
  const sheetName = monthSelect.value;
  if(!sheetName){
    alert("Pilih bulan terlebih dahulu.");
    return;
  }

  document.body.classList.add("exporting");
  exportPosterWrapper.innerHTML = `<div class="export-area">${buildPosterHTML(sheetName)}</div>`;
  exportPosterWrapper.style.display = "block";

  const exportArea = exportPosterWrapper.querySelector(".export-area");
  const posterEl = exportArea.querySelector(".poster");

  try {
    // pastikan library tersedia
    if (typeof html2canvas === "undefined") {
      await loadHtml2Canvas();
    }

    // render dengan scale 2 untuk kualitas lebih tajam
    const canvas = await html2canvas(posterEl, {
      backgroundColor: null,
      useCORS: true,
      scale: 2,
      logging: false,
      windowWidth: posterEl.scrollWidth,
      windowHeight: posterEl.scrollHeight
    });

    const dataUrl = canvas.toDataURL("image/png");
    const link = document.createElement("a");
    link.download = `Poster-${sheetName}.png`;
    link.href = dataUrl;
    link.click();
  } catch (err) {
    console.error("Gagal export poster:", err);
    alert("Gagal export poster. Silakan coba lagi.");
  } finally {
    exportPosterWrapper.style.display = "none";
    exportPosterWrapper.innerHTML = "";
    document.body.classList.remove("exporting");
  }
}

/* helper: dynamic load html2canvas jika belum ada */
function loadHtml2Canvas(){
  return new Promise((resolve, reject) => {
    if (window.html2canvas) return resolve();
    const s = document.createElement("script");
    s.src = "https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js";
    s.onload = () => resolve();
    s.onerror = (e) => reject(e);
    document.head.appendChild(s);
  });
}

/* hook tombol export */
btnExport.addEventListener("click", exportPoster);

/* INIT */
loadData();
</script>


</body>
</html> 
